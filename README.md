# AI Travel Planner

### 让旅行规划变得简单、智能、高效

## 📋 项目简介

AI Travel Planner 是一个 Web 版的智能旅行规划助手，旨在简化旅行规划过程。通过集成大语言模型和语音识别技术，系统能够理解用户的自然语言需求，自动生成详细的个性化旅行路线，并提供全方位的旅行辅助功能，包括费用管理、行程收藏、旅行日记等。

---

## ✨ 功能特性

### 🎯 核心功能

#### 1. 智能行程规划

**语音/文本智能输入**

- 支持**语音识别**输入旅行需求（基于浏览器 Web Speech API）
- 支持文本输入，灵活选择输入方式
- 自然语言理解：例如输入 *"我想去日本，5天，预算1万元，喜欢美食和动漫，带孩子"*
- 实时语音识别反馈，支持中文识别

**AI 智能解析与规划**

- 自动解析用户输入的关键信息：
  - 🗺️ 旅行目的地
  - 📅 出发日期和结束日期
  - 💰 预算金额
  - 👨‍👩‍👧‍👦 同行人数
  - 🎨 旅行偏好（美食、文化、自然、购物、冒险、摄影、亲子、情侣等）
  - 📝 特殊需求（如无障碍设施、素食餐厅等）

**个性化行程生成**

- 基于大语言模型（通过阿里云通义千问 API）生成详细的旅行计划
- 生成内容包括：
  - 📍 每日详细行程安排
  - 🚗 交通方式建议
  - 🏨 住宿推荐
  - 🎭 景点推荐及游玩时间
  - 🍜 餐厅推荐
  - 💵 费用预算明细
  - ⏰ 时间安排优化
- 支持多日行程规划
- 个性化推荐，符合用户偏好

**行程管理功能**

- 行程保存：自动保存生成的行程到云端
- 行程收藏：支持将喜欢的行程加入收藏夹
- 收藏管理：查看、管理所有收藏的行程
- 行程查看：随时查看历史行程记录
- 行程删除：支持删除不需要的行程

#### 2. 费用预算与管理

**AI 智能预算估算**

- 根据目的地、天数、人数自动估算旅行预算
- 细分预算类别：
  - 🛫 交通费用
  - 🏨 住宿费用
  - 🍽️ 餐饮费用
  - 🎫 门票费用
  - 🛍️ 购物娱乐
  - 💡 其他开销
- 提供预算范围建议

**开销记录与追踪**

- 支持多种方式记录开销：
  - 手动输入费用信息
  - **语音识别**快速记录（例如："晚餐花了200元"）
- 详细记录包含：
  - 📊 费用类别（交通、住宿、餐饮、购物、门票、其他）
  - 💰 金额
  - 💱 货币类型（人民币、美元、欧元、日元等）
  - 📅 日期
  - 📝 备注说明
- 支持查看所有费用记录
- 按类别、日期范围筛选查询

**AI 费用分析**

- **智能分析**：调用大语言模型分析开销数据
- 生成消费洞察：
  - 📈 各类别费用占比
  - 💸 超支预警
  - 🎯 消费建议
  - 📊 费用趋势分析
- 支持自定义分析查询（例如："分析我最近一周的消费"）
- 可视化图表展示
- 提供节省建议和优化方案

#### 3. 地图探索功能

**高德地图集成**

- 基于高德地图 API 实现地理位置服务
- 实时地图展示
- 支持地图缩放、拖拽、旋转

**地点搜索与展示**

- 搜索目的地城市的热门景点
- 分类显示：
  - 🏞️ 景点
  - 🍜 餐厅
  - 🏨 酒店
  - 🛍️ 购物中心
- 地图标记显示
- 地点详情展示

**路线规划**

- 支持多点路线规划
- 提供多种交通方式：
  - 🚗 驾车
  - 🚶 步行
  - 🚌 公交
- 显示距离和预估时间

#### 4. 旅行日记

**日记创建与编辑**

- 记录旅行中的美好时光
- 支持字段：
  - 📅 日期
  - 📝 标题
  - 💭 正文内容
  - 📷 图片（支持多张）
  - 📍 地理位置
  - 😊 心情状态（开心、兴奋、平静、疲惫等）
- Markdown 格式渲染
- 支持编辑和删除日记

**日记管理**

- 按时间顺序展示所有日记
- 日记详情查看
- 图片预览
- 心情标记

#### 5. 用户管理与数据存储

**注册登录系统**

- 用户注册：支持用户名密码注册
- 用户登录：JWT Token 认证
- 密码加密：使用 bcrypt 算法安全存储
- 会话管理：Token 自动续期

**云端数据同步**

- 所有数据存储在云端（Redis 数据库）
- 多设备同步：
  - 📱 旅行计划
  - 💰 费用记录
  - 📔 旅行日记
  - ⚙️ 用户偏好
- 数据持久化保存
- 自动备份机制

**个人数据管理**

- 查看所有个人数据
- 数据隔离：每个用户的数据完全独立
- 数据安全：访问控制和权限验证

---

## 🏗️ 技术架构

### 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **React** | 19.1.1 | 前端框架，构建用户界面 |
| **TypeScript** | 5.9.3 | 类型安全的 JavaScript 超集 |
| **React Router** | 6.18.0 | 前端路由管理 |
| **Vite** | 7.1.11 | 现代化前端构建工具 |
| **高德地图 API** | @amap/amap-jsapi-loader 1.0.1 | 地图服务和地理位置功能 |
| **React Markdown** | 10.1.0 | Markdown 渲染 |
| **Web Speech API** | 浏览器原生 | 语音识别功能 |

**前端特性：**

- 🎨 响应式设计，适配多种设备
- 🚀 单页应用（SPA），流畅的用户体验
- 🎤 集成浏览器原生语音识别
- 🗺️ 地图为主的交互界面
- 📊 数据可视化展示
- 🌐 跨平台支持

### 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **Go** | 1.24.5 | 高性能后端编程语言 |
| **Gin** | 1.11.0 | 轻量级 Web 框架 |
| **Redis** | go-redis/v9 9.6.1 | 高性能内存数据库，数据存储 |
| **JWT** | golang-jwt/v5 5.3.0 | 用户认证和授权 |
| **Bcrypt** | golang.org/x/crypto | 密码加密 |
| **结巴分词** | gojieba 1.4.6 | 中文文本智能解析 |

**后端特性：**

- 🔐 JWT 身份认证
- 📝 完善的日志系统
- 🔄 RESTful API 设计
- ⚡ 高并发处理能力
- 🛡️ CORS 跨域支持
- 🔒 数据加密和安全

### AI 服务

| 服务 | 提供商 | 用途 |
|------|--------|------|
| **大语言模型** | 阿里云通义千问（Qwen-Plus） | 行程规划、费用分析、文本解析 |
| **语音识别** | 浏览器 Web Speech API | 实时语音转文本 |

**AI 能力：**

- 🧠 自然语言理解
- 💬 智能对话生成
- 📊 数据分析与洞察
- 🎯 个性化推荐
- 🔍 智能文本解析

### 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                         用户界面层                            │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐   │
│  │ 行程规划 │ 费用管理 │ 地图探索 │ 旅行日记 │ 用户中心 │          │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘   │
└─────────────────────────────────────────────────────────────┘
                              ↕ HTTP/HTTPS
┌─────────────────────────────────────────────────────────────┐
│                         后端服务层                            │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                   Gin Web 框架                        │   │
│  │  ┌────────┬─────────┬─────────┬─────────┬────────┐   │   │
│  │  │认证服务│行程服务 │费用服务 │日记服务 │AI服务        │   │   │
│  │  └────────┴─────────┴─────────┴─────────┴────────┘   │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                    ↕                           ↕
┌──────────────────────────┐      ┌──────────────────────────┐
│       数据存储层           │      │       外部 API 服务       │
│  ┌──────────────────┐    │      │  ┌──────────────────┐    │
│  │  Redis 数据库     │    │      │  │ 阿里云通义千问     │    │
│  │  - 用户数据       │    │      │  │ (Qwen-Plus)      │    │
│  │  - 行程数据       │    │      │  └──────────────────┘    │
│  │  - 费用数据       │    │      │  ┌──────────────────┐    │
│  │  - 日记数据       │    │      │  │ 高德地图 API       │    │
│  └──────────────────┘    │      │  └──────────────────┘    │
└──────────────────────────┘      └──────────────────────────┘
```

---

## 🚀 快速开始

### 环境要求

- **Node.js**: >= 18.0.0
- **Go**: >= 1.24.5
- **Redis**: >= 6.0
- **现代浏览器**：支持 Web Speech API（推荐 Chrome/Edge）

### 安装步骤

#### 1. 克隆项目

```bash
git clone https://github.com/Stellarist/travel_planner.git
cd travel_planner
```

#### 2. 配置文件

编辑根目录下的 `config.json` 文件：

```json
{
    "server": {
        "host": "127.0.0.1",
        "port": 3000
    },
    "redis": {
        "addr": "127.0.0.1:6379",
        "password": "",
        "db": 0
    },
    "model": {
        "apikey": "your-qwen-api-key",
        "baseurl": "https://dashscope.aliyuncs.com/compatible-mode/v1",
        "model": "qwen-plus"
    },
    "frontend": {
        "apiBaseUrl": "http://127.0.0.1:3000",
        "backendBaseUrl": "http://127.0.0.1:3000",
        "amapKey": "your-amap-key",
        "amapSecurityJsCode": "your-amap-security-code"
    }
}
```

**配置说明：**

- `model.apikey`: 阿里云通义千问 API 密钥
- `amapKey`: 高德地图 Web 端 API Key
- `amapSecurityJsCode`: 高德地图安全密钥

#### 3. 一键启动所有服务（推荐）

项目提供了便捷的启动脚本，可以同时启动 Redis、后端和前端服务。

**Linux/Mac 用户：**

```bash
chmod +x start-dev.sh
./start-dev.sh
```

启动脚本功能：

- ✅ 自动检测环境依赖（Redis、Go、Node.js）
- 🚀 并行启动所有服务
- 📝 日志输出到 `logs/` 目录
- 🔄 自动监控服务状态
- ⚡ 按 `Ctrl+C` 停止所有服务

#### 4. 手动启动（可选）

如果你想分别启动各个服务：

**启动 Redis：**

```bash
# Windows
redis-server

# Linux/Mac
redis-server --port 6379
```

**启动后端服务：**

```bash
cd backend
go mod download
go run main.go
```

后端服务将在 `http://127.0.0.1:3000` 启动

**启动前端服务：**

```bash
cd frontend
npm install
npm run dev
```

前端服务将在 `http://localhost:5173` 启动（默认 Vite 端口）

### 访问应用

在浏览器中打开 `http://localhost:5173`，开始使用 AI Travel Planner！

---

## 📖 使用指南

### 1. 注册与登录

1. 首次使用需要注册账号
2. 输入用户名和密码完成注册
3. 使用注册的账号登录系统

### 2. 智能行程规划

#### 方式一：语音输入（推荐）

1. 进入"行程规划"页面
2. 点击麦克风图标开始语音识别
3. 说出你的旅行需求，例如：

   ```
   我想去日本东京，5天，预算1万元，
   喜欢美食和动漫，带一个孩子
   ```

4. 系统自动解析并填充表单
5. 点击"生成行程"按钮

#### 方式二：表单输入

1. 进入"行程规划"页面
2. 手动填写表单：
   - 目的地
   - 出发日期和结束日期
   - 预算
   - 同行人数
   - 选择旅行偏好（可多选）
   - 填写特殊需求（可选）
3. 点击"生成行程"按钮

#### 查看和管理行程

- **查看行程详情**：生成后自动显示详细行程
- **收藏行程**：点击"❤️ 收藏"按钮将行程加入收藏夹
- **查看收藏**：点击"我的收藏"查看所有收藏的行程
- **删除行程**：在行程列表中删除不需要的行程

### 3. 费用管理

#### 记录费用

**语音记录**：

1. 进入"预算管理"页面
2. 点击"语音记录"
3. 说出费用信息，例如："午餐花了150元"
4. 系统自动解析并保存

**手动记录**：

1. 点击"添加开销"
2. 填写费用信息：
   - 类别（交通/住宿/餐饮等）
   - 金额
   - 货币
   - 日期
   - 备注
3. 点击"保存"

#### 查看费用记录

- 在费用列表中查看所有记录
- 支持按类别筛选
- 支持按日期范围筛选
- 查看总金额统计

#### AI 费用分析

1. 进入"费用分析"页面
2. 选择筛选条件（可选）：
   - 类别
   - 日期范围
3. 点击"开始分析"
4. 查看 AI 生成的分析报告：
   - 消费分布
   - 超支预警
   - 节省建议
   - 费用趋势

### 4. 地图探索

1. 进入"地图探索"页面
2. 输入目的地城市
3. 查看热门景点、餐厅、酒店
4. 点击地图标记查看详情
5. 规划多点路线
6. 选择交通方式查看导航

### 5. 旅行日记

#### 创建日记

1. 进入"旅行日记"页面
2. 点击"写日记"
3. 填写日记内容：
   - 日期
   - 标题
   - 正文（支持 Markdown）
   - 上传图片
   - 选择地点
   - 选择心情
4. 点击"保存"

#### 管理日记

- 查看所有日记列表
- 点击查看日记详情
- 编辑已有日记
- 删除不需要的日记

---

## 🎨 界面展示

### 主要功能页面

- **登录页面**：简洁的用户登录界面
- **仪表盘**：展示用户概览和快捷入口
- **行程规划**：智能语音输入和表单填写
- **费用管理**：费用记录和统计展示
- **费用分析**：AI 分析报告和可视化图表
- **地图探索**：交互式地图和地点搜索
- **旅行日记**：图文并茂的日记展示

---

## 🔧 API 接口

### 认证相关

- `POST /api/register` - 用户注册
- `POST /api/login` - 用户登录

### 行程管理

- `POST /api/trips/plan` - 生成行程计划
- `GET /api/trips` - 获取用户所有行程
- `GET /api/trips/:id` - 获取单个行程详情
- `DELETE /api/trips/:id` - 删除行程
- `GET /api/trips/favorites/list` - 获取收藏行程
- `POST /api/trips/favorites/:id` - 添加收藏
- `DELETE /api/trips/favorites/:id` - 取消收藏

### 费用管理

- `POST /api/expenses` - 创建费用记录
- `GET /api/expenses` - 获取费用列表
- `POST /api/expenses/analyze` - AI 费用分析

### 日记管理

- `POST /api/diaries` - 创建日记
- `GET /api/diaries` - 获取所有日记
- `GET /api/diaries/:id` - 获取单条日记
- `PUT /api/diaries/:id` - 更新日记
- `DELETE /api/diaries/:id` - 删除日记

### 智能解析

- `POST /api/parser/parse` - 解析行程语音文本
- `POST /api/parser/expense` - 解析费用语音文本

### 地图相关

- `GET /api/explore/search` - 搜索地点

---

## 📊 数据结构

### 用户数据（User）

```typescript
{
  id: number,
  username: string,
  password: string (encrypted),
  createdAt: string
}
```

### 行程数据（TripPlan）

```typescript
{
  id: string,
  userId: number,
  username: string,
  destination: string,
  startDate: string,
  endDate: string,
  budget: number,
  travelers: number,
  preferences: string[],
  specialNeeds: string,
  plan: string,           // AI 生成的详细行程
  isFavorited: boolean,
  createdAt: string
}
```

### 费用记录（ExpenseRecord）

```typescript
{
  id: string,
  category: string,       // 交通/住宿/餐饮/购物/门票/其他
  amount: number,
  currency: string,       // CNY/USD/EUR/JPY
  note: string,
  date: string,           // YYYY-MM-DD
  createdAt: string
}
```

### 日记（DiaryEntry）

```typescript
{
  id: number,
  userId: number,
  date: string,
  title: string,
  content: string,
  images: string[],
  location: string,
  mood: string,           // 开心/兴奋/平静/疲惫
  createdAt: string,
  updatedAt: string
}
```

---

## 🌟 项目亮点

### 1. 语音交互体验

- 🎤 **真正的语音输入**：集成浏览器原生语音识别
- 🧠 **智能文本解析**：结合中文分词和大语言模型
- 💬 **自然语言理解**：支持自然的口语化表达

### 2. AI 驱动的智能化

- 🤖 **大语言模型集成**：使用阿里云通义千问
- 📝 **智能行程生成**：根据用户需求自动规划
- 📊 **费用智能分析**：提供专业的消费建议
- 🎯 **个性化推荐**：基于用户偏好定制

### 3. 完整的数据管理

- ☁️ **云端存储**：数据安全可靠
- 🔄 **多设备同步**：随时随地访问
- 🔐 **用户隔离**：数据完全独立
- 💾 **持久化保存**：不会丢失数据

### 4. 优秀的用户体验

- 🎨 **现代化 UI**：简洁美观的界面设计
- 📱 **响应式设计**：适配多种设备
- ⚡ **流畅交互**：单页应用，无刷新体验
- 🗺️ **地图集成**：直观的地理位置展示

### 5. 健壮的技术架构

- 🚀 **高性能后端**：Go 语言 + Gin 框架
- ⚡ **快速数据库**：Redis 内存数据库
- 🔒 **安全认证**：JWT + Bcrypt 加密
- 📝 **完善日志**：详细的操作日志记录

---

## 🛠️ 开发说明

### 项目结构

```
travel_planner/
├── backend/                 # 后端代码
│   ├── main.go             # 入口文件
│   ├── api/                # API 响应和中间件
│   │   ├── response.go     # 统一响应格式
│   │   └── segmenter.go    # 中文分词
│   ├── config/             # 配置管理
│   │   └── config.go       # 配置加载
│   ├── handlers/           # 请求处理器
│   │   ├── auth_handler.go         # 认证
│   │   ├── trip_handler.go         # 行程
│   │   ├── expense_handler.go      # 费用
│   │   ├── diary_handler.go        # 日记
│   │   ├── explore_handler.go      # 地图
│   │   ├── trip_parser_handler.go  # 行程解析
│   │   └── expense_parser_handler.go # 费用解析
│   └── service/            # 业务逻辑
│       ├── ai_client_service.go    # AI 客户端
│       ├── auth_service.go         # 认证服务
│       ├── trip_service.go         # 行程服务
│       ├── expense_service.go      # 费用服务
│       ├── diary_service.go        # 日记服务
│       ├── store_service.go        # 数据存储
│       └── logger_service.go       # 日志服务
├── frontend/               # 前端代码
│   ├── src/
│   │   ├── App.tsx        # 应用主组件
│   │   ├── main.tsx       # 入口文件
│   │   ├── components/    # 页面组件
│   │   │   ├── Login.tsx          # 登录页
│   │   │   ├── Dashboard.tsx      # 仪表盘
│   │   │   ├── TripPlanner.tsx    # 行程规划
│   │   │   ├── BudgetManager.tsx  # 费用管理
│   │   │   ├── ExpenseAnalysis.tsx # 费用分析
│   │   │   ├── ExploreMap.tsx     # 地图探索
│   │   │   └── TravelDiary.tsx    # 旅行日记
│   │   ├── shared/        # 共享代码
│   │   │   ├── types.ts           # 类型定义
│   │   │   ├── constants.ts       # 常量定义
│   │   │   └── utils.ts           # 工具函数
│   │   └── styles/        # 样式文件
│   └── package.json       # 前端依赖
├── config.json            # 配置文件
├── go.mod                 # Go 依赖
├── start.ps1              # 启动脚本
└── README.md              # 项目文档
```

### 本地开发

**后端开发**：

```bash
cd backend
go run main.go
```

**前端开发**：

```bash
cd frontend
npm run dev
```

**查看日志**：
后端日志保存在 `logs/` 目录下
